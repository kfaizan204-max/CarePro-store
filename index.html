<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Uniform Stock Manager</title>
<style>
:root {
  --blue1: #89f7fe;
  --blue2: #66a6ff;
  --text: #333;
}
body {
  font-family: sans-serif;
  margin:0;
  padding:0;
  background: linear-gradient(120deg, var(--blue1), var(--blue2));
  background-size: 400% 400%;
  animation: gradientBG 15s ease infinite;
  color: var(--text);
}
@keyframes gradientBG{
  0%{background-position:0% 50%}
  50%{background-position:100% 50%}
  100%{background-position:0% 50%}
}
header, section { padding: 20px; }
h1,h2 { margin: 0 0 10px 0; text-align: center; }
table { width: 100%; border-collapse: collapse; margin-top: 20px; }
th, td { border: 1px solid #aaa; padding: 8px; text-align: center; }
input { width: 80px; padding: 5px; }
button { padding: 5px 10px; margin: 2px; cursor:pointer; border:none; border-radius:5px; background:#66a6ff; color:#fff; font-weight:600; transition:.3s;}
button:hover{ background:#89f7fe; color:#000; }
</style>
</head>
<body>

<header>
  <h1>Uniform Stock Manager</h1>
</header>

<section id="stockSection">
<h2>Stock Summary</h2>
<button onclick="saveStock()">ðŸ’¾ Save Changes</button>
<table id="stockTable">
<thead>
<tr><th>Item</th><th>Added</th><th>Delivered</th><th>Available</th></tr>
</thead>
<tbody></tbody>
</table>
</section>

<script>
const STOCK_API = "https://sheetdb.io/api/v1/2y1u7hp9ykzlq?sheet=Stock";
const TRAN_API = "https://sheetdb.io/api/v1/2y1u7hp9ykzlq?sheet=Transactions";

let stockData = [];
let transactions = [];

// --- Update Delivered and Available ---
function updateAvailable() {
  stockData.forEach(item => {
    const delivered = transactions.filter(t => t.Item === item.Item).reduce((sum,t)=>sum + t.Qty, 0);
    item.Delivered = delivered;
    item.Available = (item.Added||0) - delivered;
  });
}

// --- Render Stock Table ---
function renderStock() {
  const tbody = document.querySelector('#stockTable tbody');
  tbody.innerHTML = '';
  stockData.forEach((r) => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${r.Item}</td>
      <td><input type="number" value="${r.Added}" oninput="editStock('${r.Item}', this.value)"></td>
      <td>${r.Delivered}</td>
      <td>${r.Available}</td>
    `;
    tbody.appendChild(tr);
  });
}

// --- Edit Stock Quantity ---
function editStock(itemName, value){
  const row = stockData.find(r => r.Item===itemName);
  if(row) row.Added = Number(value);
  updateAvailable();
  renderStock();
}

// --- Save Stock to SheetDB ---
async function saveStock(){
  try{
    const payload = { data: stockData.map(r=>({Item:r.Item, Added:r.Added, Delivered:r.Delivered, Available:r.Available})) };
    const res = await fetch(STOCK_API, {
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify(payload)
    });
    if(res.ok) alert("âœ… Stock saved successfully!");
    else alert("âŒ Failed to save.");
  }catch(err){ console.error(err); alert("âŒ Error saving stock."); }
}

// --- Load Stock and Transactions ---
async function loadStockData(){
  try{
    const sRes = await fetch(STOCK_API);
    const sJson = await sRes.json();
    stockData = sJson.map(r=>({Item:r.Item, Added:+r.Added, Delivered:+r.Delivered, Available:+r.Available}));

    const tRes = await fetch(TRAN_API);
    const tJson = await tRes.json();
    transactions = tJson.map(t=>({Item:t.Item, Qty:+t.Qty}));
  }catch(err){ console.error(err); }
  updateAvailable();
  renderStock();
}

// Load on page load
loadStockData();
</script>

</body>
</html>
