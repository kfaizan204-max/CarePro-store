<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Uniform Stock Manager</title>
<style>
:root { --blue1:#89f7fe; --blue2:#66a6ff; }
body {
  font-family:sans-serif;
  margin:0; padding:0;
  background:linear-gradient(120deg,var(--blue1),var(--blue2));
  background-size:400% 400%;
  animation: gradientBG 15s ease infinite;
  color:#333;
}
@keyframes gradientBG {
  0%{background-position:0% 50%}
  50%{background-position:100% 50%}
  100%{background-position:0% 50%}
}
header, section {
  padding:15px; margin:10px;
  background:rgba(255,255,255,0.85);
  border-radius:10px; backdrop-filter:blur(6px);
  box-shadow:0 4px 15px rgba(0,0,0,0.1);
}
h1 { text-align:center; color:#004aad; }

table { width:100%; border-collapse:collapse; margin-top:10px; border-radius:8px; overflow:hidden; }
th,td { border:1px solid #aaa; padding:8px; text-align:center; font-size:14px; }
th { background:#007bff; color:#fff; }

input {
  width:100%; padding:5px; text-align:center;
  border:none; background:#f8f8f8;
}
input:focus {
  background:#e0ffe0;
  outline:2px solid #66a6ff;
}

button {
  padding:10px 18px; margin:8px 4px;
  border:none; border-radius:6px;
  background:#007bff; color:#fff; cursor:pointer; font-weight:bold;
  transition:0.3s;
}
button:hover { background:#66a6ff; color:#000; transform:scale(1.05); }

#saveMsg {
  position:fixed;
  top:20px; right:20px;
  background:#4CAF50;
  color:white; padding:10px 20px;
  border-radius:8px;
  font-weight:bold;
  display:none;
  animation:fadeInOut 3s ease forwards;
}
@keyframes fadeInOut {
  0% {opacity:0; transform:translateY(-20px);}
  10%,90% {opacity:1; transform:translateY(0);}
  100% {opacity:0; transform:translateY(-20px);}
}
</style>
</head>
<body>

<header>
  <h1>Uniform Stock Manager</h1>
</header>

<section>
  <h2>Stock Summary</h2>
  <table id="stockTable">
    <thead>
      <tr><th>#</th><th>Item</th><th>Added</th><th>Delivered</th><th>Available</th></tr>
    </thead>
    <tbody></tbody>
  </table>
  <div style="text-align:right;">
    <button onclick="saveStock()">üíæ Save Changes</button>
  </div>
</section>

<div id="saveMsg">‚úÖ Saved Successfully!</div>

<script>
const STOCK_API = "https://sheetdb.io/api/v1/2y1u7hp9ykzlq?sheet=Stock";
let stockData = [];

// --- Load Data ---
async function loadData() {
  try {
    const res = await fetch(STOCK_API);
    const json = await res.json();
    stockData = json.map(r => ({
      Item: r.Item,
      Added: +r.Added || 0,
      Delivered: +r.Delivered || 0,
      Available: +r.Available || 0
    }));
    renderStock();
  } catch (err) {
    console.error("Load error:", err);
    alert("‚ùå Failed to load data. Check your API or Sheet name in URL.");
  }
}

// --- Render Stock Table ---
function renderStock() {
  const tbody = document.querySelector("#stockTable tbody");
  tbody.innerHTML = "";
  stockData.forEach((r, i) => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${i + 1}</td>
      <td>${r.Item}</td>
      <td><input type="number" value="${r.Added}" onchange="stockData[${i}].Added=this.value"></td>
      <td>${r.Delivered}</td>
      <td>${r.Available}</td>
    `;
    tbody.appendChild(tr);
  });
}

// --- Save All Changes in One Request ---
async function saveStock() {
  try {
    const payload = { data: stockData };
    const res = await fetch(STOCK_API, {
      method: "PUT",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });
    if (!res.ok) throw new Error(await res.text());

    const msg = document.getElementById("saveMsg");
    msg.style.display = "block";
    setTimeout(() => msg.style.display = "none", 3000);
    loadData(); // Auto-refresh after save
  } catch (err) {
    console.error("Save error:", err);
    alert("‚ùå Save failed. Check your SheetDB API or sheet name.");
  }
}

// Load data when page opens
loadData();
</script>

</body>
</html>
