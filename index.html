<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Uniform Stock Manager</title>
<style>
:root { --blue1:#89f7fe; --blue2:#66a6ff; }
body {
  font-family:sans-serif;
  margin:0; padding:0;
  background:linear-gradient(120deg,var(--blue1),var(--blue2));
  background-size:400% 400%;
  animation: gradientBG 15s ease infinite;
  color:#333;
}
@keyframes gradientBG {
  0%{background-position:0% 50%}
  50%{background-position:100% 50%}
  100%{background-position:0% 50%}
}
header, section {
  padding:15px; margin:10px;
  background:rgba(255,255,255,0.85);
  border-radius:10px; backdrop-filter:blur(5px);
}
table { width:100%; border-collapse:collapse; margin-top:10px;}
th,td { border:1px solid #aaa; padding:6px; text-align:center;}
input, select { width:100%; padding:5px; margin:2px 0;}
button {
  padding:6px 12px; margin:4px;
  border:none; border-radius:6px;
  background:#66a6ff; color:#fff; cursor:pointer; font-weight:bold;
}
button:hover { background:#89f7fe; color:#000;}
#saveMsg { color:green; font-weight:bold; display:none; }
</style>
</head>
<body>

<header>
  <h1>Uniform Stock Manager</h1>
</header>

<section>
<h2>Stock Summary</h2>
<table id="stockTable">
<thead>
<tr><th>#</th><th>Item</th><th>Added</th><th>Delivered</th><th>Available</th></tr>
</thead>
<tbody></tbody>
</table>
<div style="text-align:right;">
  <button onclick="saveStock()">üíæ Update Stock Sheet</button>
  <span id="saveMsg">‚úÖ Saved successfully!</span>
</div>
</section>

<script>
const STOCK_API = "https://sheetdb.io/api/v1/2y1u7hp9ykzlq"; // Base API
let stockData = [];

// --- Render Stock ---
function renderStock(){
  const tbody = document.querySelector('#stockTable tbody');
  tbody.innerHTML='';
  stockData.forEach((r,i)=>{
    const tr = document.createElement('tr');
    tr.innerHTML=`
      <td>${i+1}</td>
      <td>${r.Item}</td>
      <td><input type="number" value="${r.Added}" onchange="stockData[${i}].Added=this.value"></td>
      <td>${r.Delivered}</td>
      <td>${r.Available}</td>`;
    tbody.appendChild(tr);
  });
}

// --- Load Data ---
async function loadData(){
  try{
    const sRes = await fetch(STOCK_API + "?sheet=Stock");
    const sJson = await sRes.json();
    stockData = sJson.map(r=>({
      Item:r.Item,
      Added:+r.Added||0,
      Delivered:+r.Delivered||0,
      Available:+r.Available||0
    }));
    renderStock();
  }catch(err){console.error(err);}
}

// --- Save (PATCH each row) ---
async function saveStock(){
  try {
    for(const s of stockData){
      const url = `${STOCK_API}/Item/${encodeURIComponent(s.Item)}?sheet=Stock`;
      const payload = { data: { Added:s.Added, Delivered:s.Delivered, Available:s.Available }};
      await fetch(url, {
        method: "PATCH",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify(payload)
      });
    }
    const msg=document.getElementById('saveMsg');
    msg.style.display='inline';
    setTimeout(()=>msg.style.display='none',2000);
  } catch(err){ console.error(err); alert("‚ùå Failed to save."); }
}

// Load when page opens
loadData();
</script>
</body>
</html>
